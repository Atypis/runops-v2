{
  "meta": {
    "id": "d506716a-f62f-4f0d-b642-6e91e147d638",
    "title": "Daily Investor Email Triage and CRM Update",
    "version": "0.91",
    "goal": "Process daily emails to identify investor communications and update the Airtable CRM.",
    "purpose": "Ensure all investor interactions from the day are accurately logged and tracked in the CRM.",
    "owner": [
      "User"
    ],
    "created": "2023-10-27T10:00:00Z"
  },
  "public": {
    "triggers": [
      {
        "type": "manual",
        "description": "Manually triggered daily to process emails."
      }
    ],
    "nodes": [
      {
        "id": "start",
        "type": "trigger",
        "label": "Start Process",
        "id_path": "start"
      },
      {
        "id": "navigate_to_gmail",
        "type": "task",
        "label": "Navigate to Gmail Inbox",
        "intent": "Open or switch to the Gmail inbox tab.",
        "id_path": "navigate_to_gmail",
        "stagehand_instruction": "go to the Gmail inbox URL or switch to the Gmail tab",
        "selector_hints": [
          "title 'Inbox'",
          "url '*mail.google.com*'"
        ],
        "wait_conditions": [
          "page is fully loaded",
          "email list is visible"
        ],
        "error_recovery": [
          "refresh the page and try again"
        ],
        "confidence_level": "high"
      },
      {
        "id": "process_emails_loop",
        "type": "loop",
        "label": "Process Emails",
        "intent": "Iterate through emails in the inbox.",
        "id_path": "process_emails_loop",
        "iterator": "visible emails in the inbox list",
        "children": [
          "click_email",
          "extract_email_data",
          "decide_investor_email",
          "mark_email_processed",
          "return_to_inbox_list_after_skip",
          "switch_to_airtable",
          "navigate_verify_airtable_base",
          "scan_or_search_for_record",
          "click_existing_record",
          "click_add_new_record",
          "fill_new_record_fields",
          "update_record_fields",
          "close_airtable_modal",
          "verify_save",
          "switch_back_to_gmail",
          "return_to_inbox_list_after_update"
        ],
        "exit_condition": "No more emails in the current view meet the processing criteria (e.g., unread, from today)",
        "isBranchRoot": true,
        "iteration_detection": "look for the next unread email list item",
        "loop_exit_signal": "no unread email list items are visible"
      },
      {
        "id": "click_email",
        "type": "task",
        "label": "Click Next Email in List",
        "intent": "Open the next relevant email.",
        "id_path": "process_emails_loop.click_email",
        "stagehand_instruction": "click the first unread email list item in the inbox",
        "selector_hints": [
          "div[role='listitem'][aria-unread='true']",
          "span.zA:first"
        ],
        "wait_conditions": [
          "email list is visible"
        ],
        "error_recovery": [
          "scroll down and retry",
          "return to inbox list and retry"
        ],
        "confidence_level": "high"
      },
      {
        "id": "extract_email_data",
        "type": "extract",
        "label": "Extract Email Data",
        "intent": "Get key information from the opened email.",
        "id_path": "process_emails_loop.extract_email_data",
        "extract_instruction": "extract the sender name, sender email address, subject line, and the visible body text from the currently open email view",
        "extract_schema": "z.object({senderName: z.string(), senderEmail: z.string().email(), subject: z.string(), body: z.string()})",
        "validation_rules": [
          "senderEmail must be a valid email format",
          "subject and body should not be empty"
        ],
        "fallback_strategy": "skip this email and log an error",
        "confidence_level": "medium"
      },
      {
        "id": "decide_investor_email",
        "type": "decision",
        "label": "Is Investor Email?",
        "intent": "Determine if the email is related to investor relations.",
        "id_path": "process_emails_loop.decide_investor_email",
        "stagehand_instruction": "analyze extracted email data (sender email domain, subject, body) for investor-related keywords or patterns",
        "validation_check": "check if sender email domain contains 'vc', 'fund', 'capital', 'invest', or if subject/body contain keywords like 'pitch deck', 'diligence', 'fundraising', 'investment', 'round', 'partners', 'ic'",
        "confidence_level": "medium",
        "error_recovery": [
          "flag for human review if uncertain"
        ]
      },
      {
        "id": "mark_email_processed",
        "type": "task",
        "label": "Mark Email Processed (Skip)",
        "intent": "Handle non-investor emails by marking them as processed.",
        "id_path": "process_emails_loop.mark_email_processed",
        "stagehand_instruction": "click the archive button or mark the email as read/processed",
        "selector_hints": [
          "button[aria-label='Archive']",
          "button[data-tooltip='Archive']"
        ],
        "confidence_level": "high"
      },
      {
        "id": "return_to_inbox_list_after_skip",
        "type": "task",
        "label": "Return to Inbox List (Skip)",
        "intent": "Go back to the main inbox view after processing an email.",
        "id_path": "process_emails_loop.return_to_inbox_list_after_skip",
        "stagehand_instruction": "click the back button to return to the inbox list",
        "selector_hints": [
          "button[aria-label='Back to Inbox']",
          "div[role='button'][aria-label='Back to Inbox']"
        ],
        "confidence_level": "high"
      },
      {
        "id": "switch_to_airtable",
        "type": "task",
        "label": "Switch to Airtable Tab",
        "intent": "Activate the browser tab containing Airtable.",
        "id_path": "process_emails_loop.switch_to_airtable",
        "stagehand_instruction": "switch to the browser tab with the title 'Investor Relationship Management App' or URL containing 'airtable.com'",
        "selector_hints": [],
        "wait_conditions": [
          "airtable tab is active",
          "page is loaded"
        ],
        "error_recovery": [
          "navigate directly to airtable.com if tab not found"
        ],
        "confidence_level": "medium"
      },
      {
        "id": "navigate_verify_airtable_base",
        "type": "task",
        "label": "Navigate/Verify Airtable Base",
        "intent": "Ensure the correct Airtable base ('Investor Relationship Management App') is open and ready.",
        "id_path": "process_emails_loop.navigate_verify_airtable_base",
        "stagehand_instruction": "verify the current Airtable base title is 'Investor Relationship Management App'. If not, navigate to it.",
        "selector_hints": [
          "title 'Investor Relationship Management App'",
          "h1:contains('Investor Relationship Management App')"
        ],
        "wait_conditions": [
          "base grid view is visible"
        ],
        "error_recovery": [
          "go to airtable.com and click the correct base tile"
        ],
        "confidence_level": "medium"
      },
      {
        "id": "scan_or_search_for_record",
        "type": "decision",
        "label": "Scan/Search for Investor Record",
        "intent": "Find the corresponding investor record in the Airtable grid.",
        "id_path": "process_emails_loop.scan_or_search_for_record",
        "stagehand_instruction": "scan the visible rows in the primary grid view for a row where the 'Investor Name' column matches the company name derived from the email sender (e.g., Beta Capital from ben@betacapital.com). If scanning is insufficient or list is long, use the search bar.",
        "selector_hints": [
          "div[role='rowgroup'] div[data-row-id]",
          "input[placeholder*='Find records']",
          "text 'No matching records found'"
        ],
        "validation_check": "check if a row exists with a matching investor name OR if a 'no records found' message appears after searching/scanning",
        "confidence_level": "medium",
        "error_recovery": [
          "try scanning entire visible area, then try searching, then flag for human review"
        ]
      },
      {
        "id": "click_existing_record",
        "type": "task",
        "label": "Click Existing Record Row",
        "intent": "Open the modal view for the found investor record.",
        "id_path": "process_emails_loop.click_existing_record",
        "stagehand_instruction": "click the grid row that contains the matching investor name",
        "selector_hints": [
          "div[role='row'][aria-selected='true']",
          "div.gridRow:has-text('{{investor_name}}')"
        ],
        "wait_conditions": [
          "modal starts opening"
        ],
        "error_recovery": [
          "scroll the grid and retry clicking",
          "return to grid view and retry scan/click"
        ],
        "confidence_level": "high"
      },
      {
        "id": "click_add_new_record",
        "type": "task",
        "label": "Click Add New Record Row",
        "intent": "Initiate creating a new investor record.",
        "id_path": "process_emails_loop.click_add_new_record",
        "stagehand_instruction": "click the empty row or button to add a new record in the grid view",
        "selector_hints": [
          "div[role='row'].emptyRow",
          "button:contains('Add record')",
          "button[aria-label='Add record']"
        ],
        "wait_conditions": [
          "new record modal opens"
        ],
        "error_recovery": [
          "refresh page and try clicking add button again"
        ],
        "confidence_level": "high"
      },
      {
        "id": "fill_new_record_fields",
        "type": "task",
        "label": "Fill New Record Fields",
        "intent": "Populate basic fields for a new investor record using extracted email data.",
        "id_path": "process_emails_loop.fill_new_record_fields",
        "stagehand_instruction": "type '{{investorName}}' in the 'Investor Name' field, type '{{contactPerson}}' in the 'Contact Person' field, type '{{senderEmail}}' in the 'Email' field, click the 'Stage' field and select 'Contacted' or 'Interested' based on email content",
        "selector_hints": [
          "input[placeholder='Investor Name']",
          "input[placeholder='Contact Person']",
          "input[placeholder='Email']",
          "div[data-control-id*='stage'] button"
        ],
        "variables_in": [
          "investorName",
          "contactPerson",
          "senderEmail",
          "emailBody",
          "emailSubject"
        ],
        "confidence_level": "medium",
        "error_conditions": [
          "fields are not editable",
          "dropdown options not found"
        ]
      },
      {
        "id": "update_record_fields",
        "type": "task",
        "label": "Update Record Interaction Details",
        "intent": "Update the last interaction date and notes.",
        "id_path": "process_emails_loop.update_record_fields",
        "stagehand_instruction": "click the 'Last Interaction' date field, select today's date from the calendar, click the 'Thread Summary / Notes' text area, append or type 'Summary: {{emailSubject}} - {{emailBodySnippet}}' into the notes field, check email content and ensure 'Follow-up Needed' checkbox is checked if needed, or unchecked if not, and if follow-up is needed, type a brief action into the 'Next Step / Action' field.",
        "selector_hints": [
          "input[placeholder='dd/mm/yyyy']",
          "div[data-control-id*='notes'] textarea",
          "label:contains('Follow-up Needed') input[type='checkbox']",
          "input[placeholder='Next Step']"
        ],
        "variables_in": [
          "emailSubject",
          "emailBodySnippet"
        ],
        "confidence_level": "medium",
        "error_conditions": [
          "date picker does not appear",
          "notes field is read-only",
          "checkbox state cannot be changed"
        ],
        "clarification_requests": [
          {
            "id": "summarize_email_body",
            "question": "How should the email body be summarized for the notes field? (e.g., first N characters, specific extracted points, AI summarization)",
            "importance": "medium"
          },
          {
            "id": "determine_stage_and_followup",
            "question": "Refine logic for automatically determining 'Stage', 'Follow-up Needed', and 'Next Step' based on email content.",
            "importance": "high"
          }
        ]
      },
      {
        "id": "close_airtable_modal",
        "type": "task",
        "label": "Close Airtable Record Modal",
        "intent": "Save changes and return to the grid view.",
        "id_path": "process_emails_loop.close_airtable_modal",
        "stagehand_instruction": "click the close button (X icon) at the top right of the modal or press Escape key",
        "selector_hints": [
          "button[aria-label='Close']",
          "svg[aria-label='Close']"
        ],
        "wait_conditions": [
          "modal disappears",
          "grid view is visible and interactive"
        ],
        "error_recovery": [
          "press Escape key",
          "wait a few seconds and retry close button"
        ],
        "confidence_level": "high"
      },
      {
        "id": "verify_save",
        "type": "extract",
        "label": "Verify Record Saved",
        "intent": "Check for visual confirmation that the record update/creation was successful.",
        "id_path": "process_emails_loop.verify_save",
        "extract_instruction": "look for a confirmation message ('Saved'), a brief success indicator (green checkmark), or verify the changes are visible in the grid view after closing the modal.",
        "extract_schema": "z.object({savedSuccessfully: z.boolean(), message: z.string().optional()})",
        "validation_rules": [
          "savedSuccessfully must be true"
        ],
        "fallback_strategy": "log a warning and proceed, but potentially flag record for review",
        "confidence_level": "medium"
      },
      {
        "id": "switch_back_to_gmail",
        "type": "task",
        "label": "Switch back to Gmail Tab",
        "intent": "Return focus to the Gmail tab to continue processing emails.",
        "id_path": "process_emails_loop.switch_back_to_gmail",
        "stagehand_instruction": "switch to the browser tab with the title 'Inbox' or URL containing 'mail.google.com'",
        "selector_hints": [],
        "wait_conditions": [
          "gmail tab is active",
          "page is loaded"
        ],
        "error_recovery": [
          "navigate directly to mail.google.com if tab not found"
        ],
        "confidence_level": "medium"
      },
      {
        "id": "return_to_inbox_list_after_update",
        "type": "task",
        "label": "Return to Inbox List (Update)",
        "intent": "Go back to the main inbox view after processing an email in Airtable.",
        "id_path": "process_emails_loop.return_to_inbox_list_after_update",
        "stagehand_instruction": "click the back button to return to the inbox list, if not already there",
        "selector_hints": [
          "button[aria-label='Back to Inbox']",
          "div[role='button'][aria-label='Back to Inbox']"
        ],
        "confidence_level": "high"
      },
      {
        "id": "end",
        "type": "end",
        "label": "End Process",
        "id_path": "end"
      }
    ],
    "edges": [
      {
        "source": "start",
        "target": "navigate_to_gmail",
        "condition": "next"
      },
      {
        "source": "navigate_to_gmail",
        "target": "process_emails_loop",
        "condition": "next"
      },
      {
        "source": "process_emails_loop",
        "target": "click_email",
        "condition": "next"
      },
      {
        "source": "click_email",
        "target": "extract_email_data",
        "condition": "next"
      },
      {
        "source": "extract_email_data",
        "target": "decide_investor_email",
        "condition": "next"
      },
      {
        "source": "decide_investor_email",
        "target": "mark_email_processed",
        "condition": "no",
        "decision_path": "N"
      },
      {
        "source": "mark_email_processed",
        "target": "return_to_inbox_list_after_skip",
        "condition": "success"
      },
      {
        "source": "return_to_inbox_list_after_skip",
        "target": "process_emails_loop",
        "condition": "next"
      },
      {
        "source": "decide_investor_email",
        "target": "switch_to_airtable",
        "condition": "yes",
        "decision_path": "Y"
      },
      {
        "source": "switch_to_airtable",
        "target": "navigate_verify_airtable_base",
        "condition": "success"
      },
      {
        "source": "navigate_verify_airtable_base",
        "target": "scan_or_search_for_record",
        "condition": "success"
      },
      {
        "source": "scan_or_search_for_record",
        "target": "click_existing_record",
        "condition": "found"
      },
      {
        "source": "scan_or_search_for_record",
        "target": "click_add_new_record",
        "condition": "not_found"
      },
      {
        "source": "click_existing_record",
        "target": "update_record_fields",
        "condition": "success"
      },
      {
        "source": "click_add_new_record",
        "target": "fill_new_record_fields",
        "condition": "success"
      },
      {
        "source": "fill_new_record_fields",
        "target": "update_record_fields",
        "condition": "success"
      },
      {
        "source": "update_record_fields",
        "target": "close_airtable_modal",
        "condition": "success"
      },
      {
        "source": "close_airtable_modal",
        "target": "verify_save",
        "condition": "success"
      },
      {
        "source": "verify_save",
        "target": "switch_back_to_gmail",
        "condition": "success",
        "validation_check": "savedSuccessfully is true"
      },
      {
        "source": "verify_save",
        "target": "close_airtable_modal",
        "condition": "failure",
        "validation_check": "savedSuccessfully is false",
        "error_recovery": [
          "log save failure and try closing modal again",
          "flag record for manual review"
        ]
      },
      {
        "source": "switch_back_to_gmail",
        "target": "return_to_inbox_list_after_update",
        "condition": "success"
      },
      {
        "source": "return_to_inbox_list_after_update",
        "target": "process_emails_loop",
        "condition": "next"
      },
      {
        "source": "process_emails_loop",
        "target": "end",
        "condition": "all_processed"
      }
    ],
    "variables": {},
    "clarification_requests": []
  }
}