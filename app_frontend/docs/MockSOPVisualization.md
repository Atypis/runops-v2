# Mock SOP Visualization Guide

This document explains how to visualize mock SOP files for development and testing purposes without needing database access or authentication.

## Overview

The application includes a special route for viewing mock SOP files stored in the `/public` directory. This is particularly useful for:

- Visualizing the reference `mocksop-original-structure.json` file
- Testing ReactFlow visualization without database access
- Comparing new SOP generation results with reference structures

## Direct SOP Route

A direct access route has been implemented that:
1. Bypasses authentication requirements
2. Reads JSON files directly from the `/public` folder
3. Renders them using the same ReactFlow visualization components

### URL Structure

```
http://localhost:3000/direct-sop/{filename}
```

Where `{filename}` can be:
- `original-structure` (to view `mocksop-original-structure.json`)
- `mocksop` (to view `mocksop.json`)
- Any other JSON file name in the public folder (with or without the .json extension)

### Examples

| To view this file | Use this URL |
|-------------------|--------------|
| `/public/mocksop-original-structure.json` | `http://localhost:3000/direct-sop/original-structure` |
| `/public/mocksop.json` | `http://localhost:3000/direct-sop/mocksop` |
| `/public/latest-sop-v0.8.json` | `http://localhost:3000/direct-sop/latest-sop-v0.8` |
| `/public/test-sop.json` | `http://localhost:3000/direct-sop/test-sop` |

## Latest SOP v0.8 Example

We've added a recent SOP generated by the v0.8 parser to the public folder:

- **File**: `/public/latest-sop-v0.8.json`
- **View**: `http://localhost:3000/direct-sop/latest-sop-v0.8`
- **Description**: This SOP was generated by the updated v0.8 parser with proper hierarchical structure
- **Purpose**: Use this to verify that the updated parser produces SOPs that render correctly in ReactFlow

This file demonstrates how the updated parser creates:
- Proper hierarchical ID naming (e.g., "L1_C3_A1_")
- Complete parent-child relationships
- Hierarchical id_path values
- Correctly formatted decision paths

## Implementation Details

This functionality is implemented through:

1. An API route at `/api/direct-sop/[sopId]` that serves JSON files from the public folder
2. A page component at `/direct-sop/[sopId]` that renders the JSON data
3. Middleware exclusions to bypass authentication for these routes

## Comparing SOP Structures

When working on the SOP parser, you can:

1. Generate a new SOP using the parser
2. Save the JSON to the `/public` folder
3. Visualize it using the direct-sop route
4. Compare it with the original structure visualization

This makes it easy to identify structural differences that might affect visualization.

## Key Structural Requirements

For proper ReactFlow visualization, SOP files must include:

1. Hierarchical ID naming (e.g., "L1_C9_A1_")
2. Parent-child relationships via `parentId` fields
3. Hierarchical positioning via `id_path` fields (e.g., "2.9.1")
4. Decision paths marked with `decision_path:"Y"` or `decision_path:"N"`

The updated SOP parser v0.8 has been configured to generate these required properties. 